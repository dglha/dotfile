!function(t){"use strict";var l=function(t,l){$.get(i(t),function(t){l&&l(e(t))}).fail(function(t){alert("Bị lỗi gì ấy... Thử lại xem.")})},e=function(t){var l=new RegExp(/Link\sDownload\s\d\:\s(mp3|m4a|flac)\s(\d*kbps|lossless)\s([\d3\.]*)\sMB/i);if(0===t.length)throw"Invalid html string";for(var e,n=$("<div>"+t+"</div"),i=n.find("title").text().replace(/Download\:\s/,""),a=[],r=n.find("#downloadlink2").html(),s=(r=r.replace(/\selse\s\{[\s\S]*/i,"")).match(/<a.*chiasenhac.*<\/a>/gi),c=0;c<s.length;c++){var o=$(s[c]);if(o.text().match(l)){var u=o.attr("href");0===c&&(e=u);var d=o.text().match(l);u.match(/login\.php/i)&&("M4A"==d[1]?u=(u=e.replace(/\/\d{3}\//i,"/m4a/")).replace(/\[.*\]\.\w{3}/i,"["+d[1]+" "+d[2]+"].m4a"):"FLAC"==d[1]&&(u=(u=e.replace(/\/\d{3}\//i,"/flac/")).replace(/\[.*\]\.\w{3}/i,"["+d[1]+" "+d[2]+"].flac"))),a.push({type:d[2],size:d[3],url:u})}}return{title:i,urls:a}},n=function(){var t=[],l=$("#fulllyric .genmed b").eq(2).children("a").length>1?"Playlist":$("#fulllyric .genmed b").eq(0).children("a").text()+" - "+$("#fulllyric .genmed b").eq(2).children("a").eq(0).text()+" ("+$("#fulllyric .genmed b").eq(3).text()+")",e=$(".playlist_prv.page-dsms").siblings("img").eq(0).attr("src");return $("#playlist table tr").each(function(l,e){l>0&&t.push({url:$(e).find("td span a").eq(0).attr("href")})}),{title:l,cover_image:e,songs:t}},i=function(t){return t.match(/_download\.html$/i)||(t=t.substring(t.length-5,0)+"_download.html"),t};t.csnParser={getSongUrl:l,getSongList:n,getAlbumUrls:function(t){var e=[],i=n(),a=0,r=function(){l(i.songs[a].url,function(l){e.push(l),a===i.songs.length-1?t.call(null,{title:i.title,songs:e}):(a++,r())})};r()},isAlbum:function(){return 0!==$("#playlist table").size()}}}(window);