!function(e){"use strict";var t=function(e,t){$.get(i(e),function(e){t&&t(l(e))}).fail(function(e){alert("Bị lỗi gì ấy... Thử lại xem.")})},l=function(e){var t=new RegExp(/Link\sDownload\s\d\:\s(mp3|m4a|flac)\s(\d*kbps|lossless)\s([\d3\.]*)\sMB/i);if(0===e.length)throw"Invalid html string";for(var l,n=$("<div>"+e+"</div"),i=n.find("title").text().replace(/Download\:\s/,""),a=[],r=n.find("#downloadlink2").html(),c=(r=r.replace(/\selse\s\{[\s\S]*/i,"")).match(/<a.*chiasenhac.*<\/a>/gi),o=0;o<c.length;o++){var s=$(c[o]);if(s.text().match(t)){var d=s.attr("href");0===o&&(l=d);var u=s.text().match(t);d.match(/login\.php/i)&&("M4A"==u[1]?d=(d=l.replace(/\/\d{3}\//i,"/m4a/")).replace(/\[.*\]\.\w{3}/i,"["+u[1]+" "+u[2]+"].m4a"):"FLAC"==u[1]&&(d=(d=l.replace(/\/\d{3}\//i,"/flac/")).replace(/\[.*\]\.\w{3}/i,"["+u[1]+" "+u[2]+"].flac"))),a.push({type:u[2],size:u[3],url:d})}}return{title:i,urls:a}},n=function(){var e=[],t=$("#fulllyric .genmed b").eq(2).children("a").length>1?"Playlist":$("#fulllyric .genmed b").eq(0).children("a").text()+" - "+$("#fulllyric .genmed b").eq(2).children("a").eq(0).text()+" ("+$("#fulllyric .genmed b").eq(3).text()+")",l=$(".playlist_prv.page-dsms").siblings("img").eq(0).attr("src");return $("#playlist table tr").each(function(t,l){t>0&&e.push({url:$(l).find("td span a").eq(0).attr("href")})}),{title:t,cover_image:l,songs:e}},i=function(e){return e.match(/_download\.html$/i)||(e=e.substring(e.length-5,0)+"_download.html"),e},a=function(e){var t=e.split("&");return decodeURIComponent(t[t.length-1].replace(/v[0-9]=/i,""))};e.scraper={getSongUrl:t,getSongList:n,getAlbumUrls:function(e){var l=[],i=n(),a=0,r=function(){t(i.songs[a].url,function(t){l.push(t),a===i.songs.length-1?e.call(null,{title:i.title,songs:l}):(a++,r())})};r()},triggerDownloadLink:function(e,t){t=t||a(e);var l=document.createElement("a");l.href=e,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l)},extractFilename:a}}(window);